<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Nextcloud Global Widget Integration</title>
</head>
<body>
    <!-- This template shows how to integrate the floating widget into Nextcloud -->
    
    <!-- Add this script to your Nextcloud template files -->
    <script>
        // Global Floating Widget Integration for Nextcloud
        // Add this script to your Nextcloud template files (like templates/layouts/user.php)
        
        document.addEventListener('DOMContentLoaded', function() {
            // Load the global floating widget script
            const script = document.createElement('script');
            script.src = '/apps/my-nextcloud-app/js/global-floating-widget.js';
            script.onload = function() {
                console.log('Global Floating Widget loaded successfully!');
            };
            document.head.appendChild(script);
        });
    </script>
    
    <!-- Alternative: Direct integration -->
    <script>
        // Direct integration without external file
        class GlobalFloatingWidget {
            constructor() {
                this.isExpanded = false;
                this.isDragging = false;
                this.unreadCount = 0;
                this.position = {
                    x: window.innerWidth - 80,
                    y: window.innerHeight - 80
                };
                this.init();
            }

            init() {
                this.createFloatingButton();
                this.createWidgetPanel();
                this.addStyles();
                this.startAutoUpdates();
            }

            createFloatingButton() {
                const button = document.createElement('div');
                button.id = 'global-floating-button';
                button.className = 'global-floating-button';
                
                button.innerHTML = `
                    <div class="button-content">
                        <div class="chat-icon">
                            <span>ðŸ’¬</span>
                        </div>
                        <div class="badge" style="display: ${this.unreadCount > 0 ? 'flex' : 'none'}">${this.unreadCount}</div>
                    </div>
                `;
                
                button.style.cssText = `
                    position: fixed;
                    width: 60px;
                    height: 60px;
                    border-radius: 50%;
                    background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
                    box-shadow: 0 8px 24px rgba(0, 122, 255, 0.3);
                    cursor: pointer;
                    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    backdrop-filter: blur(20px);
                    border: 1px solid rgba(255, 255, 255, 0.2);
                    z-index: 9999;
                    user-select: none;
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                    right: 20px;
                    bottom: 20px;
                `;
                
                button.addEventListener('click', () => this.toggleWidget());
                document.body.appendChild(button);
                this.floatingButton = button;
            }

            createWidgetPanel() {
                const panel = document.createElement('div');
                panel.id = 'global-widget-panel';
                panel.className = 'global-widget-panel';
                
                panel.innerHTML = `
                    <div class="widget-header">
                        <div class="header-content">
                            <div class="title-section">
                                <h3 class="widget-title">NextBot Assistant</h3>
                                <div class="status-indicator">
                                    <span class="status-dot online"></span>
                                    <span class="status-text">Online</span>
                                </div>
                            </div>
                            <button class="close-btn">
                                <span class="close-icon">Ã—</span>
                            </button>
                        </div>
                    </div>

                    <div class="quick-actions">
                        <button class="action-btn" onclick="window.open('/apps/spreed/', '_blank')">
                            <span class="action-icon">ðŸ’¬</span>
                            <span class="action-text">Open Talk</span>
                        </button>
                        <button class="action-btn" onclick="window.open('/apps/spreed/', '_blank')">
                            <span class="action-icon">ðŸ‘¥</span>
                            <span class="action-text">New Group</span>
                        </button>
                        <button class="action-btn" onclick="window.open('/apps/spreed/', '_blank')">
                            <span class="action-icon">ðŸ‘¤</span>
                            <span class="action-text">Add User</span>
                        </button>
                    </div>

                    <div class="chat-area">
                        <div class="messages-container" id="global-messages-container">
                            <div class="message-bubble">
                                <div class="message-avatar bot-avatar">ðŸ¤–</div>
                                <div class="message-content">
                                    <div class="message-text">Hello! I'm NextBot, your AI assistant. I can help you with Nextcloud Talk features!</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="input-area">
                        <div class="input-container">
                            <input type="text" class="message-input" placeholder="Ask NextBot anything..." id="global-message-input">
                            <button class="send-btn" id="global-send-btn">
                                <span class="send-icon">ðŸ“¤</span>
                            </button>
                        </div>
                        
                        <div class="quick-suggestions">
                            <span class="suggestion-chip" onclick="this.sendSuggestion('Create a group')">Create a group</span>
                            <span class="suggestion-chip" onclick="this.sendSuggestion('Add users')">Add users</span>
                            <span class="suggestion-chip" onclick="this.sendSuggestion('How to call?')">How to call?</span>
                            <span class="suggestion-chip" onclick="this.sendSuggestion('Show features')">Show features</span>
                        </div>
                    </div>
                `;
                
                panel.style.cssText = `
                    position: fixed;
                    bottom: 80px;
                    right: 20px;
                    width: 380px;
                    height: 500px;
                    background: rgba(255, 255, 255, 0.95);
                    backdrop-filter: blur(40px);
                    border-radius: 20px;
                    border: 1px solid rgba(255, 255, 255, 0.2);
                    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
                    transform: scale(0.1) translateY(100px);
                    opacity: 0;
                    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
                    overflow: hidden;
                    z-index: 9998;
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                `;
                
                panel.querySelector('.close-btn').addEventListener('click', () => this.minimizeWidget());
                panel.querySelector('#global-send-btn').addEventListener('click', () => this.sendMessage());
                panel.querySelector('#global-message-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.sendMessage();
                });
                
                document.body.appendChild(panel);
                this.widgetPanel = panel;
            }

            addStyles() {
                if (document.getElementById('global-widget-styles')) return;
                
                const styles = document.createElement('style');
                styles.id = 'global-widget-styles';
                styles.textContent = `
                    .global-floating-button:hover {
                        transform: scale(1.1);
                        box-shadow: 0 12px 32px rgba(0, 122, 255, 0.4);
                    }

                    .global-widget-panel.visible {
                        transform: scale(1) translateY(0);
                        opacity: 1;
                    }

                    .global-widget-panel .widget-header {
                        padding: 20px;
                        background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
                        color: white;
                    }

                    .global-widget-panel .header-content {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    }

                    .global-widget-panel .widget-title {
                        margin: 0;
                        font-size: 18px;
                        font-weight: 600;
                    }

                    .global-widget-panel .status-indicator {
                        display: flex;
                        align-items: center;
                        gap: 6px;
                        font-size: 12px;
                        opacity: 0.9;
                        margin-top: 4px;
                    }

                    .global-widget-panel .status-dot {
                        width: 8px;
                        height: 8px;
                        border-radius: 50%;
                        background: #34C759;
                    }

                    .global-widget-panel .close-btn {
                        background: rgba(255, 255, 255, 0.2);
                        border: none;
                        border-radius: 50%;
                        width: 32px;
                        height: 32px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        cursor: pointer;
                        transition: all 0.2s ease;
                        color: white;
                    }

                    .global-widget-panel .close-btn:hover {
                        background: rgba(255, 255, 255, 0.3);
                        transform: scale(1.1);
                    }

                    .global-widget-panel .close-icon {
                        font-size: 18px;
                        font-weight: 300;
                    }

                    .global-widget-panel .quick-actions {
                        display: flex;
                        padding: 16px 20px;
                        gap: 12px;
                        background: rgba(255, 255, 255, 0.8);
                        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
                    }

                    .global-widget-panel .action-btn {
                        flex: 1;
                        background: white;
                        border: 1px solid rgba(0, 0, 0, 0.1);
                        border-radius: 12px;
                        padding: 12px 8px;
                        cursor: pointer;
                        transition: all 0.2s ease;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        gap: 4px;
                        min-height: 44px;
                    }

                    .global-widget-panel .action-btn:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                    }

                    .global-widget-panel .action-icon {
                        font-size: 20px;
                    }

                    .global-widget-panel .action-text {
                        font-size: 11px;
                        font-weight: 500;
                        color: #333;
                    }

                    .global-widget-panel .chat-area {
                        flex: 1;
                        overflow-y: auto;
                        padding: 16px 20px;
                        background: rgba(248, 248, 248, 0.8);
                        max-height: 250px;
                    }

                    .global-widget-panel .messages-container {
                        display: flex;
                        flex-direction: column;
                        gap: 12px;
                    }

                    .global-widget-panel .message-bubble {
                        display: flex;
                        gap: 12px;
                    }

                    .global-widget-panel .message-avatar {
                        width: 32px;
                        height: 32px;
                        border-radius: 50%;
                        background: #007AFF;
                        color: white;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 14px;
                        font-weight: 600;
                        flex-shrink: 0;
                    }

                    .global-widget-panel .bot-avatar {
                        background: #34C759;
                    }

                    .global-widget-panel .message-content {
                        flex: 1;
                        background: white;
                        border-radius: 16px;
                        padding: 12px 16px;
                        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                        max-width: 280px;
                    }

                    .global-widget-panel .message-text {
                        font-size: 14px;
                        line-height: 1.4;
                        color: #333;
                        word-wrap: break-word;
                    }

                    .global-widget-panel .input-area {
                        padding: 16px 20px;
                        background: rgba(255, 255, 255, 0.9);
                        border-top: 1px solid rgba(0, 0, 0, 0.1);
                    }

                    .global-widget-panel .input-container {
                        display: flex;
                        gap: 12px;
                        margin-bottom: 12px;
                    }

                    .global-widget-panel .message-input {
                        flex: 1;
                        padding: 12px 16px;
                        border: 1px solid rgba(0, 0, 0, 0.2);
                        border-radius: 20px;
                        font-size: 14px;
                        outline: none;
                        background: white;
                        transition: all 0.2s ease;
                    }

                    .global-widget-panel .message-input:focus {
                        border-color: #007AFF;
                        box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
                    }

                    .global-widget-panel .send-btn {
                        width: 44px;
                        height: 44px;
                        border-radius: 50%;
                        background: #007AFF;
                        border: none;
                        color: white;
                        cursor: pointer;
                        transition: all 0.2s ease;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 16px;
                    }

                    .global-widget-panel .send-btn:hover:not(:disabled) {
                        background: #0056CC;
                        transform: scale(1.05);
                    }

                    .global-widget-panel .send-btn:disabled {
                        opacity: 0.5;
                        cursor: not-allowed;
                    }

                    .global-widget-panel .quick-suggestions {
                        display: flex;
                        gap: 8px;
                        overflow-x: auto;
                        padding-bottom: 4px;
                    }

                    .global-widget-panel .suggestion-chip {
                        background: rgba(0, 122, 255, 0.1);
                        border: 1px solid rgba(0, 122, 255, 0.2);
                        border-radius: 16px;
                        padding: 6px 12px;
                        font-size: 12px;
                        color: #007AFF;
                        cursor: pointer;
                        transition: all 0.2s ease;
                        white-space: nowrap;
                        flex-shrink: 0;
                    }

                    .global-widget-panel .suggestion-chip:hover {
                        background: rgba(0, 122, 255, 0.2);
                        transform: translateY(-1px);
                    }

                    /* Responsive */
                    @media (max-width: 480px) {
                        .global-widget-panel {
                            width: calc(100vw - 40px);
                            height: calc(100vh - 120px);
                            bottom: 80px;
                            left: 20px;
                            right: 20px;
                        }
                    }
                `;
                
                document.head.appendChild(styles);
            }

            toggleWidget() {
                this.isExpanded = !this.isExpanded;
                
                if (this.isExpanded) {
                    this.widgetPanel.classList.add('visible');
                    this.startAutoMinimize();
                } else {
                    this.widgetPanel.classList.remove('visible');
                }
            }

            minimizeWidget() {
                this.isExpanded = false;
                this.widgetPanel.classList.remove('visible');
            }

            startAutoMinimize() {
                setTimeout(() => {
                    if (this.isExpanded) {
                        this.minimizeWidget();
                    }
                }, 30000);
            }

            sendMessage() {
                const input = document.getElementById('global-message-input');
                const message = input.value.trim();
                
                if (!message) return;
                
                this.addMessage(message, false);
                input.value = '';
                
                setTimeout(() => {
                    const responses = [
                        "Great question! Let me help you with that.",
                        "I can assist you with group creation and user management in Nextcloud Talk.",
                        "Here's how you can do that in Nextcloud Talk...",
                        "That's a common question! Here's the solution:",
                        "I'm here to help! Let me provide you with the information."
                    ];
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    this.addMessage(randomResponse, true);
                }, 1500);
            }

            addMessage(text, isBot) {
                const container = document.getElementById('global-messages-container');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message-bubble';
                
                const avatar = document.createElement('div');
                avatar.className = 'message-avatar';
                if (isBot) avatar.classList.add('bot-avatar');
                avatar.textContent = isBot ? 'ðŸ¤–' : 'A';
                
                const content = document.createElement('div');
                content.className = 'message-content';
                
                const messageText = document.createElement('div');
                messageText.className = 'message-text';
                messageText.textContent = text;
                
                content.appendChild(messageText);
                messageDiv.appendChild(avatar);
                messageDiv.appendChild(content);
                container.appendChild(messageDiv);
                
                container.scrollTop = container.scrollHeight;
            }

            startAutoUpdates() {
                setInterval(() => {
                    if (!this.isExpanded && Math.random() > 0.8) {
                        this.unreadCount++;
                        this.floatingButton.querySelector('.badge').textContent = this.unreadCount;
                        this.floatingButton.querySelector('.badge').style.display = 'flex';
                    }
                }, 15000);
            }
        }

        // Initialize the widget
        if (!document.getElementById('global-floating-button')) {
            window.globalFloatingWidget = new GlobalFloatingWidget();
        }
    </script>
    
    <h1>Global Widget Integration Complete!</h1>
    <p>The floating chat widget should now appear on ALL Nextcloud pages.</p>
    <p>Look for the ðŸ’¬ button in the bottom-right corner!</p>
</body>
</html>

