<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Nextcloud Platform with iOS Widget</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Main Container */
        .platform-container {
            display: flex;
            min-height: 100vh;
            position: relative;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 30px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 700;
            color: #333;
        }

        .nav-section {
            margin-bottom: 20px;
        }

        .nav-title {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 4px;
            color: #333;
            text-decoration: none;
        }

        .nav-item:hover {
            background: rgba(0, 122, 255, 0.1);
            color: #007AFF;
        }

        .nav-item.active {
            background: #007AFF;
            color: white;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            background: rgba(248, 248, 248, 0.8);
            backdrop-filter: blur(20px);
            padding: 40px;
            overflow-y: auto;
        }

        .welcome-section {
            text-align: center;
            margin-bottom: 40px;
        }

        .welcome-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 16px;
        }

        .welcome-subtitle {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 30px;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .feature-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }

        .feature-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            margin-bottom: 16px;
        }

        .feature-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .feature-desc {
            color: #666;
            line-height: 1.5;
        }

        /* iOS Floating Widget */
        .ios-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 10000;
        }

        .floating-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
            box-shadow: 0 8px 24px rgba(0, 122, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
        }

        .floating-button:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 32px rgba(0, 122, 255, 0.4);
        }

        .floating-button.pulse {
            animation: pulse 2s infinite;
        }

        .button-content {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-icon {
            font-size: 24px;
            color: white;
            transition: transform 0.3s ease;
        }

        .badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #FF3B30;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 12px;
            font-weight: 600;
            min-width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
        }

        /* Widget Panel */
        .widget-panel {
            position: absolute;
            bottom: 80px;
            right: 20px;
            width: 400px;
            height: 600px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(40px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            transform: scale(0.1) translateY(100px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            overflow: hidden;
        }

        .widget-panel.visible {
            transform: scale(1) translateY(0);
            opacity: 1;
        }

        /* Widget Header */
        .widget-header {
            padding: 20px;
            background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
            color: white;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .widget-title {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            opacity: 0.9;
            margin-top: 4px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #34C759;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: white;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        /* Widget Tabs */
        .widget-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.8);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .tab-btn {
            flex: 1;
            padding: 12px 8px;
            border: none;
            background: transparent;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
            font-weight: 500;
            color: #666;
            border-bottom: 2px solid transparent;
        }

        .tab-btn.active {
            color: #007AFF;
            border-bottom-color: #007AFF;
            background: rgba(0, 122, 255, 0.1);
        }

        /* Widget Content */
        .widget-content {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .tab-content {
            display: none;
            flex: 1;
            overflow: hidden;
            flex-direction: column;
        }

        .tab-content.active {
            display: flex;
        }

        /* Chat Area */
        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 16px 20px;
            background: rgba(248, 248, 248, 0.8);
        }

        .messages-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message-bubble {
            display: flex;
            gap: 12px;
            animation: slideInUp 0.3s ease;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #007AFF;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .message-avatar.bot {
            background: #34C759;
        }

        .message-content {
            flex: 1;
            background: white;
            border-radius: 16px;
            padding: 12px 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            max-width: 280px;
        }

        .message-text {
            font-size: 14px;
            line-height: 1.4;
            color: #333;
            word-wrap: break-word;
        }

        /* Input Area */
        .input-area {
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.9);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .input-container {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }

        .message-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            font-size: 14px;
            outline: none;
            background: white;
            transition: all 0.2s ease;
        }

        .message-input:focus {
            border-color: #007AFF;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        .send-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: #007AFF;
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .send-btn:hover:not(:disabled) {
            background: #0056CC;
            transform: scale(1.05);
        }

        .quick-suggestions {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 4px;
        }

        .suggestion-chip {
            background: rgba(0, 122, 255, 0.1);
            border: 1px solid rgba(0, 122, 255, 0.2);
            border-radius: 16px;
            padding: 6px 12px;
            font-size: 12px;
            color: #007AFF;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .suggestion-chip:hover {
            background: rgba(0, 122, 255, 0.2);
            transform: translateY(-1px);
        }

        /* Conversations Tab */
        .conversations-header {
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.8);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 12px;
        }

        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            font-weight: 500;
        }

        .action-btn.primary {
            background: #007AFF;
            color: white;
        }

        .action-btn.primary:hover {
            background: #0056CC;
            transform: translateY(-1px);
        }

        .conversations-list {
            flex: 1;
            overflow-y: auto;
            padding: 16px 20px;
        }

        .conversation-item {
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 8px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .conversation-item:hover {
            background: rgba(0, 122, 255, 0.05);
            border-color: #007AFF;
        }

        .conversation-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .conversation-meta {
            font-size: 12px;
            color: #666;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Quick Actions Tab */
        .actions-grid {
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .action-card {
            padding: 16px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .action-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-color: #007AFF;
        }

        .action-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .action-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .action-desc {
            font-size: 11px;
            color: #666;
            line-height: 1.3;
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes slideInUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .platform-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .widget-panel {
                width: calc(100vw - 40px);
                height: calc(100vh - 120px);
                bottom: 80px;
                left: 20px;
                right: 20px;
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            .sidebar {
                background: rgba(28, 28, 30, 0.95);
                color: white;
            }
            
            .widget-panel {
                background: rgba(28, 28, 30, 0.95);
                border-color: rgba(255, 255, 255, 0.1);
            }
            
            .chat-area {
                background: rgba(44, 44, 46, 0.8);
            }
            
            .message-content {
                background: #2C2C2E;
                color: white;
            }
        }
    </style>
</head>
<body>
    <div class="platform-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <div class="logo-icon">☁️</div>
                <div class="logo-text">Nextcloud</div>
            </div>

            <div class="nav-section">
                <div class="nav-title">Main</div>
                <a href="#" class="nav-item active">
                    <div class="nav-icon">🏠</div>
                    <div>Dashboard</div>
                </a>
                <a href="#" class="nav-item">
                    <div class="nav-icon">📁</div>
                    <div>Files</div>
                </a>
                <a href="#" class="nav-item">
                    <div class="nav-icon">📅</div>
                    <div>Calendar</div>
                </a>
                <a href="#" class="nav-item">
                    <div class="nav-icon">📧</div>
                    <div>Mail</div>
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-title">Communication</div>
                <a href="#" class="nav-item">
                    <div class="nav-icon">💬</div>
                    <div>Talk</div>
                </a>
                <a href="#" class="nav-item">
                    <div class="nav-icon">📞</div>
                    <div>Calls</div>
                </a>
                <a href="#" class="nav-item">
                    <div class="nav-icon">👥</div>
                    <div>Groups</div>
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-title">Settings</div>
                <a href="#" class="nav-item">
                    <div class="nav-icon">👤</div>
                    <div>Profile</div>
                </a>
                <a href="#" class="nav-item">
                    <div class="nav-icon">⚙️</div>
                    <div>Settings</div>
                </a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="welcome-section">
                <h1 class="welcome-title">Welcome to Nextcloud</h1>
                <p class="welcome-subtitle">Your complete cloud platform with integrated iOS-style chat widget</p>
            </div>

            <div class="feature-grid">
                <div class="feature-card" onclick="openTalk()">
                    <div class="feature-icon">💬</div>
                    <div class="feature-title">Talk & Chat</div>
                    <div class="feature-desc">Secure messaging, video calls, and group conversations with AI assistance</div>
                </div>

                <div class="feature-card" onclick="openFiles()">
                    <div class="feature-icon">📁</div>
                    <div class="feature-title">File Management</div>
                    <div class="feature-desc">Store, sync, and share your files securely in the cloud</div>
                </div>

                <div class="feature-card" onclick="openCalendar()">
                    <div class="feature-icon">📅</div>
                    <div class="feature-title">Calendar</div>
                    <div class="feature-desc">Schedule meetings, events, and collaborate with your team</div>
                </div>

                <div class="feature-card" onclick="openMail()">
                    <div class="feature-icon">📧</div>
                    <div class="feature-title">Mail</div>
                    <div class="feature-desc">Professional email management with encryption and security</div>
                </div>

                <div class="feature-card" onclick="openContacts()">
                    <div class="feature-icon">👥</div>
                    <div class="feature-title">Contacts</div>
                    <div class="feature-desc">Manage your contacts and integrate with all Nextcloud apps</div>
                </div>

                <div class="feature-card" onclick="openNotes()">
                    <div class="feature-icon">📝</div>
                    <div class="feature-title">Notes</div>
                    <div class="feature-desc">Take notes, create documents, and collaborate in real-time</div>
                </div>
            </div>
        </div>
    </div>

    <!-- iOS Floating Widget -->
    <div class="ios-widget">
        <div class="floating-button" id="floating-btn">
            <div class="button-content">
                <div class="chat-icon">💬</div>
                <div class="badge" id="widget-badge" style="display: none;">0</div>
            </div>
        </div>
        
        <div class="widget-panel" id="widget-panel">
            <div class="widget-header">
                <div class="header-content">
                    <div>
                        <h3 class="widget-title">NextBot Assistant</h3>
                        <div class="status-indicator">
                            <span class="status-dot online"></span>
                            <span class="status-text">Connected to Nextcloud</span>
                        </div>
                    </div>
                    <button class="close-btn" id="close-btn">
                        <span>×</span>
                    </button>
                </div>
            </div>

            <div class="widget-tabs">
                <button class="tab-btn active" data-tab="chat">💬 Chat</button>
                <button class="tab-btn" data-tab="conversations">👥 Conversations</button>
                <button class="tab-btn" data-tab="actions">⚡ Quick Actions</button>
            </div>

            <div class="widget-content">
                <!-- Chat Tab -->
                <div class="tab-content active" id="tab-chat">
                    <div class="chat-area">
                        <div class="messages-container" id="messages-container">
                            <div class="message-bubble">
                                <div class="message-avatar bot">🤖</div>
                                <div class="message-content">
                                    <div class="message-text">Hello! I'm NextBot, your AI assistant. I'm integrated with your Nextcloud platform and can help you with Talk, Files, Calendar, and more! What would you like to do?</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="input-area">
                        <div class="input-container">
                            <input type="text" class="message-input" placeholder="Ask me about Nextcloud features..." id="message-input">
                            <button class="send-btn" id="send-btn">📤</button>
                        </div>
                        <div class="quick-suggestions">
                            <span class="suggestion-chip" data-suggestion="Show my conversations">Show my conversations</span>
                            <span class="suggestion-chip" data-suggestion="Create a new group">Create a new group</span>
                            <span class="suggestion-chip" data-suggestion="How to start a video call?">How to start a video call?</span>
                            <span class="suggestion-chip" data-suggestion="Show my files">Show my files</span>
                        </div>
                    </div>
                </div>

                <!-- Conversations Tab -->
                <div class="tab-content" id="tab-conversations">
                    <div class="conversations-header">
                        <button class="action-btn primary" id="create-group-btn">
                            <span>👥</span>
                            <span>New Group</span>
                        </button>
                        <button class="action-btn secondary" id="refresh-conversations">
                            <span>🔄</span>
                            <span>Refresh</span>
                        </button>
                    </div>
                    <div class="conversations-list" id="conversations-list">
                        <div class="conversation-item">
                            <div class="conversation-name">General Discussion</div>
                            <div class="conversation-meta">
                                <span>4 members</span>
                                <span>👥</span>
                            </div>
                        </div>
                        <div class="conversation-item">
                            <div class="conversation-name">Project Updates</div>
                            <div class="conversation-meta">
                                <span>2 members</span>
                                <span>👥</span>
                            </div>
                        </div>
                        <div class="conversation-item">
                            <div class="conversation-name">Team Chat</div>
                            <div class="conversation-meta">
                                <span>6 members</span>
                                <span>👥</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions Tab -->
                <div class="tab-content" id="tab-actions">
                    <div class="actions-grid">
                        <button class="action-card" onclick="openTalk()">
                            <div class="action-icon">💬</div>
                            <div class="action-title">Open Talk</div>
                            <div class="action-desc">Access full Talk interface</div>
                        </button>
                        <button class="action-card" onclick="startCall()">
                            <div class="action-icon">📞</div>
                            <div class="action-title">Start Call</div>
                            <div class="action-desc">Begin video/audio call</div>
                        </button>
                        <button class="action-card" onclick="createGroup()">
                            <div class="action-icon">👥</div>
                            <div class="action-title">Create Group</div>
                            <div class="action-desc">New group conversation</div>
                        </button>
                        <button class="action-card" onclick="openFiles()">
                            <div class="action-icon">📁</div>
                            <div class="action-title">Files</div>
                            <div class="action-desc">Access your files</div>
                        </button>
                        <button class="action-card" onclick="openCalendar()">
                            <div class="action-icon">📅</div>
                            <div class="action-title">Calendar</div>
                            <div class="action-desc">Schedule meetings</div>
                        </button>
                        <button class="action-card" onclick="openMail()">
                            <div class="action-icon">📧</div>
                            <div class="action-title">Mail</div>
                            <div class="action-desc">Check your emails</div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Widget state
        let widgetState = {
            isExpanded: false,
            unreadCount: 0,
            conversations: [
                { name: 'General Discussion', members: 4, type: 'group' },
                { name: 'Project Updates', members: 2, type: 'group' },
                { name: 'Team Chat', members: 6, type: 'group' }
            ]
        };

        // Initialize widget
        function initWidget() {
            const floatingBtn = document.getElementById('floating-btn');
            const widgetPanel = document.getElementById('widget-panel');
            const closeBtn = document.getElementById('close-btn');
            const sendBtn = document.getElementById('send-btn');
            const messageInput = document.getElementById('message-input');
            const tabBtns = document.querySelectorAll('.tab-btn');
            const suggestionChips = document.querySelectorAll('.suggestion-chip');

            // Toggle widget
            floatingBtn.addEventListener('click', toggleWidget);
            closeBtn.addEventListener('click', minimizeWidget);

            // Send message
            sendBtn.addEventListener('click', sendMessage);
            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });

            // Tab switching
            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => switchTab(btn.dataset.tab));
            });

            // Suggestion chips
            suggestionChips.forEach(chip => {
                chip.addEventListener('click', () => {
                    const suggestion = chip.dataset.suggestion;
                    messageInput.value = suggestion;
                    sendMessage();
                });
            });

            // Action buttons
            document.getElementById('create-group-btn')?.addEventListener('click', createGroup);
            document.getElementById('refresh-conversations')?.addEventListener('click', loadConversations);

            // Start periodic updates
            startPeriodicUpdates();
        }

        // Widget control functions
        function toggleWidget() {
            widgetState.isExpanded = !widgetState.isExpanded;
            const panel = document.getElementById('widget-panel');
            
            if (widgetState.isExpanded) {
                panel.classList.add('visible');
                widgetState.unreadCount = 0;
                updateBadge();
                startAutoMinimize();
            } else {
                panel.classList.remove('visible');
            }
        }

        function minimizeWidget() {
            widgetState.isExpanded = false;
            document.getElementById('widget-panel').classList.remove('visible');
        }

        function startAutoMinimize() {
            setTimeout(() => {
                if (widgetState.isExpanded) {
                    minimizeWidget();
                }
            }, 30000);
        }

        function updateBadge() {
            const badge = document.getElementById('widget-badge');
            badge.textContent = widgetState.unreadCount;
            badge.style.display = widgetState.unreadCount > 0 ? 'flex' : 'none';
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }

        // Message handling
        function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            if (!message) return;

            addMessage(message, false);
            input.value = '';

            // Process message with AI
            processAIMessage(message);
        }

        function addMessage(text, isBot) {
            const container = document.getElementById('messages-container');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message-bubble';
            
            messageDiv.innerHTML = `
                <div class="message-avatar ${isBot ? 'bot' : 'user'}">${isBot ? '🤖' : 'A'}</div>
                <div class="message-content">
                    <div class="message-text">${text}</div>
                </div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function processAIMessage(message) {
            const lowerMessage = message.toLowerCase();
            
            setTimeout(() => {
                let response = '';
                
                if (lowerMessage.includes('conversation') || lowerMessage.includes('chat')) {
                    response = `Here are your current conversations:\n\n${widgetState.conversations.map(conv => `• ${conv.name} (${conv.members} members)`).join('\n')}\n\nClick the "Conversations" tab to see more details!`;
                    switchTab('conversations');
                } else if (lowerMessage.includes('group') || lowerMessage.includes('create')) {
                    response = "I'll help you create a new group! You can use the 'New Group' button in the Conversations tab, or I can open the group creation dialog for you.";
                    createGroup();
                } else if (lowerMessage.includes('call') || lowerMessage.includes('video')) {
                    response = "To start a video call, I can open the Talk app for you or help you initiate a call from any conversation. Let me open Talk for you!";
                    openTalk();
                } else if (lowerMessage.includes('file')) {
                    response = "I can help you access your files! Let me open the Files app for you.";
                    openFiles();
                } else if (lowerMessage.includes('help')) {
                    response = "I can help you with:\n• Managing conversations and groups\n• Starting video calls\n• Accessing your files\n• Scheduling calendar events\n• Managing emails\n\nTry asking me about any of these topics!";
                } else {
                    const responses = [
                        "I'm here to help with Nextcloud features! Try asking about conversations, groups, files, or video calls.",
                        "I can assist you with all Nextcloud functionality. What would you like to know?",
                        "I'm your integrated Nextcloud assistant. How can I help you today?",
                        "I can help you manage your Nextcloud workspace. What do you need?"
                    ];
                    response = responses[Math.floor(Math.random() * responses.length)];
                }
                
                addMessage(response, true);
            }, 1500);
        }

        // App functions
        function openTalk() {
            alert('Opening Talk app... (In real implementation, this would navigate to /apps/spreed/)');
            // window.open('/apps/spreed/', '_blank');
        }

        function openFiles() {
            alert('Opening Files app... (In real implementation, this would navigate to /apps/files/)');
            // window.open('/apps/files/', '_blank');
        }

        function openCalendar() {
            alert('Opening Calendar app... (In real implementation, this would navigate to /apps/calendar/)');
            // window.open('/apps/calendar/', '_blank');
        }

        function openMail() {
            alert('Opening Mail app... (In real implementation, this would navigate to /apps/mail/)');
            // window.open('/apps/mail/', '_blank');
        }

        function openContacts() {
            alert('Opening Contacts app... (In real implementation, this would navigate to /apps/contacts/)');
            // window.open('/apps/contacts/', '_blank');
        }

        function openNotes() {
            alert('Opening Notes app... (In real implementation, this would navigate to /apps/notes/)');
            // window.open('/apps/notes/', '_blank');
        }

        function startCall() {
            alert('Starting video call... (In real implementation, this would initiate a call)');
        }

        function createGroup() {
            const groupName = prompt('Enter group name:');
            if (groupName) {
                alert(`Creating group "${groupName}"... (In real implementation, this would create the group)`);
            }
        }

        function loadConversations() {
            alert('Refreshing conversations... (In real implementation, this would load from API)');
        }

        // Periodic updates
        function startPeriodicUpdates() {
            // Simulate new messages
            setInterval(() => {
                if (!widgetState.isExpanded && Math.random() > 0.8) {
                    widgetState.unreadCount++;
                    updateBadge();
                    document.getElementById('floating-btn').classList.add('pulse');
                }
            }, 20000);
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initWidget);

        // Export for global access
        window.NextcloudPlatform = {
            toggleWidget,
            minimizeWidget,
            openTalk,
            openFiles,
            openCalendar,
            openMail,
            createGroup,
            startCall
        };
    </script>
</body>
</html>
